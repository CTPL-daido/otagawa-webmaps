<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>地理院タイル切替マップ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/leaflet.css" />
  <link rel="stylesheet" href="css/L.Control.Layers.Tree.css" />
  <link rel="stylesheet" href="css/qgis2web.css" />
  <link rel="stylesheet" href="css/fontawesome-all.min.css" />
  <link rel="stylesheet" href="css/MarkerCluster.css" />
  <link rel="stylesheet" href="css/MarkerCluster.Default.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="js/qgis2web_expressions.js"></script>
  <script src="js/leaflet.js"></script>
  <script src="js/L.Control.Layers.Tree.min.js"></script>
  <script src="js/leaflet.rotatedMarker.js"></script>
  <script src="js/leaflet.pattern.js"></script>
  <script src="js/leaflet-hash.js"></script>
  <script src="js/Autolinker.min.js"></script>
  <script src="js/rbush.min.js"></script>
  <script src="js/labelgun.min.js"></script>
  <script src="js/labels.js"></script>
  <script src="js/leaflet.markercluster.js"></script>
  <script src="data/_1.js"></script>
  <script src="data/gis_2.js"></script>

  <script>
    var map = L.map('map', {
      zoomControl: false,
      maxZoom: 28,
      minZoom: 1
    }).fitBounds([
      [35.02150630669538, 136.89041981871463],
      [35.024273635120316, 136.89502311629542]
    ]);

    var hash = new L.Hash(map);
    map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
    var autolinker = new Autolinker({ truncate: { length: 30, location: 'smart' } });

    // ズームボタン
    L.control.zoom({ position: 'topleft' }).addTo(map);

    var bounds_group = new L.featureGroup([]);
    function setBounds() {
      map.fitBounds(bounds_group.getBounds());
    }

    // 地理院タイル：淡色地図
    map.createPane('pane___1');
    map.getPane('pane___1').style.zIndex = 399;
    var layer___1 = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', {
      pane: 'pane___1',
      opacity: 1.0,
      attribution: '地理院タイル（淡色地図）',
      minZoom: 1,
      maxZoom: 18
    });
    map.addLayer(layer___1); // 初期表示に設定

    // 地理院タイル：全国最新写真
    map.createPane('pane_03___0');
    map.getPane('pane_03___0').style.zIndex = 398;
    var layer_03___0 = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg', {
      pane: 'pane_03___0',
      opacity: 1.0,
      attribution: '地理院タイル（全国最新写真）',
      minZoom: 1,
      maxZoom: 18
    });

    // ポリゴンレイヤ
    map.createPane('pane__1');
    map.getPane('pane__1').style.zIndex = 401;
    var layer__1 = new L.geoJson(json__1, {
      attribution: '',
      interactive: true,
      pane: 'pane__1',
      style: function () {
        return {
          color: 'red',
          weight: 2,
          fill: false
        };
      },
      onEachFeature: function (feature, layer) {
        var content = '<table><tr><td>fid:</td><td>' + feature.properties.fid + '</td></tr></table>';
        layer.bindPopup(content);
      }
    });
    map.addLayer(layer__1);
    bounds_group.addLayer(layer__1);

    // 点レイヤ（クラスター）
    map.createPane('pane_gis_2');
    map.getPane('pane_gis_2').style.zIndex = 402;
    var layer_gis_2 = new L.geoJson(json_gis_2, {
      attribution: '',
      interactive: true,
      pane: 'pane_gis_2',
      pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, {
          radius: 5,
          fillColor: '#ffcc00',
          color: '#000',
          weight: 1,
          opacity: 1,
          fillOpacity: 1
        });
      },
      onEachFeature: function (feature, layer) {
        var content = '<table><tr><td>fid:</td><td>' + feature.properties.fid + '</td></tr>';
        if (feature.properties.URL) {
          content += '<tr><td>URL:</td><td><a href="' + feature.properties.URL + '" target="_blank">リンク</a></td></tr>';
        }
        content += '</table>';
        layer.bindPopup(content);
      }
    });

    var cluster_gis_2 = new L.MarkerClusterGroup({ showCoverageOnHover: false });
    cluster_gis_2.addLayer(layer_gis_2);
    map.addLayer(cluster_gis_2);
    bounds_group.addLayer(layer_gis_2);

    // レイヤ一覧（切り替え）
    var overlaysTree = [
      { label: '<img src="legend/gis_2.png" /> gis点', layer: cluster_gis_2 },
      { label: '<img src="legend/_1.png" /> 枠', layer: layer__1 },
      { label: '地理院タイル（淡色地図）', layer: layer___1, radioGroup: 'basemap' },
      { label: '地理院タイル（全国最新写真）', layer: layer_03___0, radioGroup: 'basemap' }
    ];

    L.control.layers.tree(null, overlaysTree, { collapsed: false }).addTo(map);

    setBounds();
  </script>
</body>
</html>