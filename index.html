<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, width=device-width, viewport-fit=cover, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- 既存アセット（qgis2web出力のまま） -->
  <link rel="stylesheet" href="css/leaflet.css">
  <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
  <link rel="stylesheet" href="css/qgis2web.css">
  <style>
    html, body { margin:0; padding:0; height:100%; -webkit-tap-highlight-color: transparent; }
    #map { width:100vw; height:100svh; touch-action: pan-x pan-y pinch-zoom; }
    /* 枠は見えるけどタップは通す（点が押せるように） */
    .leaflet-pane.pane-frame,
    .leaflet-pane.pane-frame * { pointer-events:none !important; }
    /* パネルの見た目はqgis2web標準のまま（画像の感じ） */
    .leaflet-control-layers-tree { max-height:70svh; overflow:auto; }
  </style>
  <title>レイヤツリー（前と同じ見た目）</title>
</head>
<body>
  <div id="map"></div>

  <!-- JS資産 -->
  <script src="js/leaflet.js"></script>
  <script src="js/L.Control.Layers.Tree.min.js"></script>
  <script src="js/leaflet-hash.js"></script>

  <!-- データ（qgis2web出力） -->
  <script src="data/_2.js"></script>    <!-- 枠 -->
  <script src="data/gis_3.js"></script> <!-- 点（URL属性） -->

  <script>
    // ===== Map =====
    const map = L.map('map', { zoomControl:true, maxZoom:28, minZoom:1 })
      .fitBounds([[35.02142399844622,136.88612396178715],[35.02547667835214,136.89563370359895]]);
    new L.Hash(map);

    // 出典
    map.attributionControl.setPrefix('<a href="https://leafletjs.com" target="_blank" rel="noopener">Leaflet</a> · <a href="https://qgis.org" target="_blank" rel="noopener">QGIS</a> · qgis2web');
    map.attributionControl.addAttribution('地理院タイル（国土地理院）');

    // ===== Base layers（画像のようにラジオ） =====
    map.createPane('pane_base_photo');  map.getPane('pane_base_photo').style.zIndex = 200;
    map.createPane('pane_base_pale');   map.getPane('pane_base_pale').style.zIndex  = 201;

    const layer_photo = L.tileLayer(
      'https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg',
      { pane:'pane_base_photo', minNativeZoom:2, maxNativeZoom:18 }
    );
    const layer_pale = L.tileLayer(
      'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png',
      { pane:'pane_base_pale',  minNativeZoom:2, maxNativeZoom:18 }
    );
    // 最初は写真側をON（画像例に合わせる）
    layer_photo.addTo(map);

    // ===== Frame（枠：常時表示・タッチ透過） =====
    map.createPane('pane_frame'); map.getPane('pane_frame').classList.add('pane-frame');
    map.getPane('pane_frame').style.zIndex = 402;

    const layer_frame = L.geoJSON(json__2, {
      pane:'pane_frame',
      interactive:false,
      style: ()=>({
        opacity:1, color:'rgba(227,26,28,1.0)', weight:11,
        fill:true, fillOpacity:0
      })
    }).addTo(map);

    // ===== Points（gis点：タップで直リンク） =====
    map.createPane('pane_points'); map.getPane('pane_points').style.zIndex = 403;

    const layer_points = L.geoJSON(json_gis_3, {
      pane:'pane_points',
      pointToLayer: (f, latlng)=> L.circleMarker(latlng, {
        radius:10, opacity:1, color:'rgba(35,35,35,1.0)', weight:1,
        fill:true, fillOpacity:1, fillColor:'rgba(229,182,54,1.0)'
      }),
      onEachFeature: (feature, layer)=>{
        const props = feature && feature.properties ? feature.properties : {};
        const url = (props.URL || props.url || props.Url || props.link || '').toString().trim();
        if (url) layer.on('click', ()=> location.href = url);
      }
    }).addTo(map);

    // ===== qgis2web風ツリーパネル（画像の見た目） =====
    const overlaysTree = [
      { label: '<img src="legend/gis_3.png" /> gis点', layer: layer_points },
      { label: '<img src="legend/_2.png" /> 枠', layer: layer_frame },
      { label: '地理院タイル_淡色地図', layer: layer_pale,   radioGroup:'bm' },
      { label: '03_地理院タイル_(全国最新写真（シームレス））', layer: layer_photo, radioGroup:'bm' }
    ];
    L.control.layers.tree(null, overlaysTree, { collapsed:false }).addTo(map);

    // レイアウト再計算（回転/アドレスバーで）
    addEventListener('resize', ()=> map.invalidateSize(), { passive:true });
  </script>
</body>
</html>