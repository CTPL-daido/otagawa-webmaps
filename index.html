<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, width=device-width, viewport-fit=cover, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="css/leaflet.css">
  <link rel="stylesheet" href="css/qgis2web.css">
  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; -webkit-tap-highlight-color: transparent; }
    #map { width:100vw; height:100svh; touch-action: pan-x pan-y pinch-zoom; }
    .leaflet-interactive { cursor:pointer; }
    .leaflet-control-attribution { display:block !important; font-size:12px; }
    .leaflet-control-layers { max-height: 70svh; overflow:auto; }

    /* ★ 枠は常時表示＆タッチ透過（上の点タップを邪魔しない） */
    .leaflet-pane.pane-frame,
    .leaflet-pane.pane-frame * { pointer-events: none !important; }
  </style>
  <title>Web Map</title>
</head>
<body>
  <div id="map"></div>

  <!-- 既存アセット -->
  <script src="js/leaflet.js"></script>
  <script src="js/leaflet-hash.js"></script>
  <script src="data/_2.js"></script><!-- 枠 -->
  <script src="data/gis_3.js"></script><!-- 点（URL属性あり） -->

  <script>
    // ===== Map =====
    const map = L.map('map', {
      zoomControl: true,
      dragging: true,
      touchZoom: true,
      tap: true,
      scrollWheelZoom: true,
      maxZoom: 20, minZoom: 1
    }).fitBounds([[35.00873592469054,136.8754285322846],[35.03087538697442,136.9122549129309]]);
    new L.Hash(map);

    // 出典（コピーライト）
    map.attributionControl.setPrefix('<a href="https://leafletjs.com" target="_blank" rel="noopener">Leaflet</a>');
    map.attributionControl.addAttribution('地理院タイル（国土地理院） / qgis2web / QGIS');

    // ===== ベース地図 =====
    const gsiPhoto = L.tileLayer(
      'https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg',
      { minZoom:1, maxZoom:20, minNativeZoom:2, maxNativeZoom:18 }
    );
    const gsiPale = L.tileLayer(
      'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png',
      { minZoom:1, maxZoom:20, minNativeZoom:2, maxNativeZoom:18 }
    ).addTo(map); // 初期は淡色

    // ===== Pane（描画順） =====
    // 枠（下段・タッチ透過）
    const framePane = map.createPane('pane_frame');
    framePane.classList.add('pane-frame');
    framePane.style.zIndex = 330;

    // 点（上段・タッチ取得）
    const pointsPane = map.createPane('pane_points');
    pointsPane.style.zIndex = 450;

    // ===== 枠（_2）——常時表示・タッチ透過 =====
    function style__2_0() {
      return { opacity:1, color:'#e31a1c', weight:11, fill:true, fillOpacity:0, interactive:false };
    }
    const layer__2 = L.geoJSON(json__2, {
      pane:'pane_frame', style: style__2_0, interactive:false
    }).addTo(map);

    // ===== 点（gis_3）——タップで直リンク（ポップアップなし） =====
    function style_gis_3_0() {
      return { radius:8, color:'#000', weight:2, fill:true, fillColor:'#fff', fillOpacity:1 };
    }
    function onEach_gis_3(feature, layer){
      // URL/ url / Url などゆるく対応
      const f = feature && feature.properties ? feature.properties : {};
      const url = (f.URL || f.url || f.Url || f.link || '').toString().trim();
      if (url) {
        layer.on('click', () => {
          // スマホでも確実に遷移させたいので _self
          location.href = url;
        });
      }
    }
    const layer_gis_3 = L.geoJSON(json_gis_3, {
      pane:'pane_points',
      pointToLayer: (f, latlng)=> L.circleMarker(latlng, style_gis_3_0(f)),
      onEachFeature: onEach_gis_3
    }).addTo(map);

    // ===== レイヤコントロール（前と同じくシンプル） =====
    L.control.layers(
      { "地理院タイル_淡色地図": gsiPale, "全国最新写真（シームレス）": gsiPhoto },
      { "gis点": layer_gis_3, "枠（常時表示）": layer__2 },
      { collapsed:false, position:'topright' }
    ).addTo(map);

    // 画面回転・アドレスバー変動で再レイアウト
    addEventListener('resize', ()=> map.invalidateSize(), { passive:true });
  </script>
</body>
</html>